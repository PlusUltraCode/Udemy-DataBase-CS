# ì„¹ì…˜4. ë°ì´í„°ë² ì´ìŠ¤ ì¸ë±ì‹±

## 22. ì¸ë±ìŠ¤ ì‹œì‘í•˜ê¸°

### Postgresì˜ ê¸°ë³¸ ì ì¸ ëª…ë ¹ì–´

```sql
# ìŠ¤í‚¤ë§ˆ ì •ë³´ ì¶œë ¥
\d í…Œì´ë¸” ì´ë¦„

explain analyze select id from employees where id = 2000;
```

### Index ìœ ë¬´ í™•ì¸

![image.png](%E1%84%8B%E1%85%B2%E1%84%83%E1%85%A6%E1%84%86%E1%85%B5%20%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%E1%84%87%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%80%E1%85%A8%2016564b4a4ab480ec8556dff4ee610feb/image%2010.png)

idê°€ 2000ì¸ íŠœí”Œì„ ì°¾ê¸° ìœ„í•´ PostgresëŠ” Index Scanì„ í†µí•´ ì°¾ê²Œ ëœë‹¤. ì´ ì •ë³´ì—ëŠ” Heap Fetches ë˜í•œ ë³¼ ìˆ˜ ìˆë‹¤.

IDëŠ” Indexë¥¼ í†µí•´ ë§¤ìš° ë¹ ë¥´ê²Œ ìŠ¤ìº”ì´ ê°€ëŠ¥í•˜ì§€ë§Œ ID ëŒ€ì‹  nameì„ ì¡°íšŒí•  ê²½ìš° ì–´ë–»ê²Œ ë ê¹Œ?

```sql
explain analyze select id from employees where name = 'Zs';
```

![image.png](%E1%84%8B%E1%85%B2%E1%84%83%E1%85%A6%E1%84%86%E1%85%B5%20%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%E1%84%87%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%80%E1%85%A8%2016564b4a4ab480ec8556dff4ee610feb/image%2011.png)

Nameì—ëŠ” ì¸ë±ìŠ¤ê°€ ì—†ê¸° ë•Œë¬¸ì— Parallel Seq Scan(ìˆœì°¨ì  ìŠ¤ìº”)ì„ í†µí•´ nameì´ â€˜Zsâ€™ì¸ íŠœí”Œì„ ì°¾ê²Œ ëœë‹¤.

ì´ë³´ë‹¤ ë” ëŠë¦° ì¿¼ë¦¬ëŠ” LIKEë¥¼ ì‚¬ìš©í•œ ì¿¼ë¦¬ì´ë‹¤. LIKE ì‚¬ìš© ì‹œ, í•´ë‹¹ ì¡°ê±´ì— ë§ëŠ”ì§€ ë¬¸ìì—´ì„ ëª¨ë‘ í™•ì¸í•´ì•¼í•˜ê¸° ë•Œë¬¸ì´ë‹¤.

![image.png](%E1%84%8B%E1%85%B2%E1%84%83%E1%85%A6%E1%84%86%E1%85%B5%20%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%E1%84%87%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%80%E1%85%A8%2016564b4a4ab480ec8556dff4ee610feb/image%2012.png)

### ì¸ë±ìŠ¤ ì ìš©í•˜ê¸°

ì•„ê¹Œì „ì— ì‚´í´ë³¸ name ì¹¼ëŸ¼ì— ëŒ€í•´ ì¸ë±ìŠ¤ë¥¼ ì¶”ê°€í•´ë³´ì.

```sql
create index employees_name on employees(name);
```

![image.png](%E1%84%8B%E1%85%B2%E1%84%83%E1%85%A6%E1%84%86%E1%85%B5%20%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%E1%84%87%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%80%E1%85%A8%2016564b4a4ab480ec8556dff4ee610feb/image%2013.png)

ì•„ê¹Œì™€ ë¹„êµí•´ì„œ Execution Timeì´ 89msì •ë„ ë¹¨ë¼ì¡Œë‹¤. ë˜í•œ ìì„¸íˆë³´ë©´ Bitmap Heap Scanì„ í†µí•´ ìŠ¤ìº”ì´ ì§„í–‰ëœë‹¤.

<aside>
ğŸ’¡

### Expressionì˜ ì¸ë±ì‹±

ì¸ë±ìŠ¤ëŠ” ë‹¨ì¼ê°’ì— ëŒ€í•´ì„œë§Œ ì ìš©ì´ ê°€ëŠ¥í•˜ë‹¤. ê·¸ëŸ¬ë©´ Likeì™€ ê°™ì€ í‘œí˜„ì‹ì„ ì‚¬ìš©í•  ê²½ìš° nameì— ëŒ€í•œ ì¸ë±ìŠ¤ì˜ íš¨ê³¼ë¥¼ ë³¼ ìˆ˜ ìˆì„ê¹Œ?

![image.png](%E1%84%8B%E1%85%B2%E1%84%83%E1%85%A6%E1%84%86%E1%85%B5%20%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%E1%84%87%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%80%E1%85%A8%2016564b4a4ab480ec8556dff4ee610feb/image%2014.png)

ì „í˜€ ì¸ë±ìŠ¤ì˜ íš¨ê³¼ë¥¼ ë³´ì§€ ëª»í•˜ê³ , Parallel Seq Scanì„ ì§„í–‰í•˜ê¸°ì— ìˆ˜í–‰ì‹œê°„ì€ ë˜‘ê°™ë‹¤.

ì¸ë±ìŠ¤ëŠ” ë‹¨ì¼ ê°’ì— ëŒ€í•´ì„œë§Œ ì ìš©ë¨ì„ ëª…ì‹¬í•˜ì.

</aside>

<aside>
ğŸ’¡

ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•  ì§€ì— ëŒ€í•´ì„  ë°ì´í„°ë² ì´ìŠ¤ì˜ `í”Œë˜ë„ˆ`ê°€ ê²°ì •í•œë‹¤.

</aside>

# ğŸ¤”ê¶ê¸ˆí•œì 

1. ë¬¸ìì—´ì˜ ê²½ìš° B-Treeì—ì„  ì–´ë–»ê²Œ ì €ì¥ë˜ëŠ”ê°€? ë‹¨ìˆœíˆ ì‚¬ì „ìˆœìœ¼ë¡œ ì •ë ¬ë˜ëŠ”ê°€?
2. Parallel Seq Scanê³¼ Seq Scan ì°¨ì´

## 23. Explainìœ¼ë¡œ SQL ì¿¼ë¦¬ í”Œë˜ë„ˆì™€ ì˜µí‹°ë§ˆì´ì € ì´í•´í•˜ê¸°

### í…Œì´ë¸” ì…‹íŒ…

![image.png](%E1%84%8B%E1%85%B2%E1%84%83%E1%85%A6%E1%84%86%E1%85%B5%20%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%E1%84%87%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%80%E1%85%A8%2016564b4a4ab480ec8556dff4ee610feb/image%2015.png)

### ì¿¼ë¦¬ í…ŒìŠ¤íŠ¸ #1

![image.png](%E1%84%8B%E1%85%B2%E1%84%83%E1%85%A6%E1%84%86%E1%85%B5%20%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%E1%84%87%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%80%E1%85%A8%2016564b4a4ab480ec8556dff4ee610feb/image%2016.png)

- costì˜ ì²«ë²ˆì§¸ : ì²« ë²ˆì§¸ í˜ì´ì§€ë¥¼ ê°€ì ¸ì˜¤ëŠ”ë° ê±¸ë¦° ì‹œê°„ (ms)
- costì˜ ë‘ë²ˆì§¸ : ì´ ê±¸ë¦° ì‹œê°„
    - ìœ„ ê³„ì‚°ì€ ë‹¨ì§€ ì˜µí‹°ë§ˆì´ì €ì— ì˜í•œ ì¶”ì •ì— ë¶ˆê³¼
    

ìœ„ ì¿¼ë¦¬ì˜ ê²½ìš° ì¦‰ì‹œ í…Œì´ë¸”ë¡œ ì´ë™í•˜ì—¬ ì²« ë²ˆì§¸ í–‰ì„ ê°€ì ¸ì˜¤ê¸° ë•Œë¬¸ì— ë¹„ìš©ì´ ë“¤ì§€ ì•ŠëŠ”ë‹¤. ë”°ë¼ì„œ, limit 1ì„ ì‚¬ìš© ì‹œ ë§¤ìš° ë¹ ë¥´ê²Œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.

### ì¿¼ë¦¬ í…ŒìŠ¤íŠ¸ #2

![image.png](%E1%84%8B%E1%85%B2%E1%84%83%E1%85%A6%E1%84%86%E1%85%B5%20%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%E1%84%87%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%80%E1%85%A8%2016564b4a4ab480ec8556dff4ee610feb/image%2017.png)

ì¸ë±ìŠ¤ë¡œ ì¸í•´ ë¯¸ë¦¬ ì •ë ¬ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— ìƒëŒ€ì ìœ¼ë¡œ ì‘ì—… ì‹œê°„ì´ ë§¤ìš° ì ê²Œ ë“ ë‹¤.

### ì¿¼ë¦¬ í…ŒìŠ¤íŠ¸ #3

![image.png](%E1%84%8B%E1%85%B2%E1%84%83%E1%85%A6%E1%84%86%E1%85%B5%20%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%E1%84%87%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%80%E1%85%A8%2016564b4a4ab480ec8556dff4ee610feb/image%2018.png)

nameì— ëŒ€í•œ ì¸ë±ìŠ¤ê°€ ì—†ê¸° ë•Œë¬¸ì— ëŠë ¤ì•¼ í•˜ì§€ë§Œ, ì´ìƒí•˜ê²Œ ë¹ ë¥´ê²Œ ë‚˜ì˜¨ë‹¤.

### ì¿¼ë¦¬ í…ŒìŠ¤íŠ¸ #4

![image.png](%E1%84%8B%E1%85%B2%E1%84%83%E1%85%A6%E1%84%86%E1%85%B5%20%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%E1%84%87%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%80%E1%85%A8%2016564b4a4ab480ec8556dff4ee610feb/image%2019.png)

### ì¿¼ë¦¬ í…ŒìŠ¤íŠ¸ #5

![image.png](%E1%84%8B%E1%85%B2%E1%84%83%E1%85%A6%E1%84%86%E1%85%B5%20%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%E1%84%87%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%80%E1%85%A8%2016564b4a4ab480ec8556dff4ee610feb/image%2020.png)

## 24. ë¹„íŠ¸ë§µ ì¸ë±ìŠ¤ ìŠ¤ìº” & ì¸ë±ìŠ¤ ìŠ¤ìº” & í…Œì´ë¸” ìŠ¤ìº”

```sql
explain select name from grades where id < 100;
```

```sql
Index Scan using grades_pkey on grades (cost=0.43..391.13 rows=98 width=4)
	Index Cond: (id < 100)
(2 rows)
```

B íŠ¸ë¦¬ì—ì„œ ì´ ì‘ì—…ì„ ë¹ ë¥´ê²Œ ìˆ˜í–‰

PostgresëŠ” ëª‡ ê°œì˜ í–‰ì´ ë°˜í™˜ë ì§€ì— ëŒ€í•œ ì •ë³´ë¥¼ ì•Œê³  ìˆìŒ

ì°¾ëŠ” ê°ê°ì˜ ê°’ì— ëŒ€í•´ ê·¸ í–‰ì´ ì¡´ì¬í•˜ëŠ” í˜ì´ì§€ë¥¼ ì°¾ê³  í™ìœ¼ë¡œ ëŒì•„ê°€ì„œ í˜ì´ì§€ë¥¼ ê°€ì ¸ì˜¨ í›„ í•´ë‹¹ ê°’ì„ ì¶”ì¶œ

ì´ëŸ° ë°©ë²•ì„ ëœë¤ ì—‘ì„¸ìŠ¤ë¼ê³  í•œë‹¤.

ì´ëŸ° ëœë¤ ì—‘ì„¸ìŠ¤ëŠ” í–‰ì´ ë§ì„ ê²½ìš° ëŠë ¤ì§ˆ ìˆ˜ ìˆë‹¤

ì´ë²ˆì—” id > 100ì— ëŒ€í•œ ë¶„ì„

```sql
explain select name from grades where id > 100;
```

```sql
Seq Scan using grades_pkey on grades (cost=0.00..134265.34 rows=5000248 width=4)
	Index Cond: (id > 100)

```

í…Œì´ë¸”ë¡œ ì§ì ‘ ì´ë™í•˜ì—¬ ìˆœì°¨ ìŠ¤ìº”ì„ ì‚¬ìš©í•œë‹¤. ì´ ê²½ìš° ëœë¤ ì—‘ì„¸ìŠ¤ ë³´ë‹¤ ë§¤ìš° ì ì€ ì½”ìŠ¤íŠ¸ë¥¼ ê°€ì§€ê¸° ë•Œë¬¸ì— ìˆœì°¨ íƒìƒ‰ì„ ì§„í–‰í•œë‹¤.

ë”°ë¼ì„œ, í–‰ì´ ì–¼ë§ˆë‚˜ ë§ì€ê°€ì— ë”°ë¼ ì¸ë±ìŠ¤ ìŠ¤ìº”ê³¼ ìˆœì°¨ ìŠ¤ìº”ì´ ê²°ì •ë˜ëŠ” ê²ƒìœ¼ë¡œ ë³´ì¸ë‹¤. 

(í–‰ì´ ì ì„ ê²½ìš° ì¸ë±ìŠ¤ ìŠ¤ìº”, í–‰ì´ ë§ì„ ê²½ìš° ìˆœì°¨ ìŠ¤ìº”)

ê·¼ë° ì´ëŸ° ì‹ìœ¼ë¡œ í–‰ì´ ì• ë§¤í•  ê²½ìš°ì— ë¹„íŠ¸ë§µ ìŠ¤ìº”ì„ ì‹¤ì‹œí•œë‹¤. ë¹„íŠ¸ë§µ ìŠ¤ìº”ì€ ì¸ë±ìŠ¤ ìŠ¤ìº”ì—ì„œ ë°œìƒí•˜ëŠ” ëœë¤ ì—‘ì„¸ìŠ¤ë¥¼ ë°©ì§€í•˜ë©´ì„œ ì¸ë±ìŠ¤ì˜ ì„±ëŠ¥ì„ ì–´ëŠ ì •ë„ ê°€ì ¸ì˜¨ë‹¤. ë˜í•œ ê²½ì§ëœ BTree ëŒ€ì‹  ë¹„íŠ¸ë§µì„ ì‚¬ìš©í•˜ì—¬ íš¨ìœ¨ì´ ë” ì¢‹ë‹¤.

ì‚¬ì‹¤ PostgresëŠ” ë¹„íŠ¸ë§µ ì¸ë±ìŠ¤ ìŠ¤ìº”ì„ ì§„í–‰í•œë‹¤. (gì— ëŒ€í•œ ì¸ë±ìŠ¤ê°€ ìˆë‹¤ê³  ê°€ì •)

```sql
explain select name from grades where g > 95;
```

```sql
Bitmap Heap Scan using grades_pkey on grades (cost=3859.77..110758.53 rows=205850 width=4)
	Recheck Cond: (g > 95)
	-> Bitmap Index Scan on g(cost=0.00..3808.31 rows=205850 width=0)
		Index Cond: (g > 95)
```

![image.png](%E1%84%8B%E1%85%B2%E1%84%83%E1%85%A6%E1%84%86%E1%85%B5%20%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%E1%84%87%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%80%E1%85%A8%2016564b4a4ab480ec8556dff4ee610feb/image%2021.png)

1. ë¹„íŠ¸ë§µ ì¸ë±ìŠ¤ ìŠ¤ìº”ìœ¼ë¡œ ì¸ë±ìŠ¤ë¥¼ ê°€ì ¸ì™€ ë¹„íŠ¸ë§µì„ ë§Œë“ ë‹¤.
    - ì¸ë±ìŠ¤ ìŠ¤ìº”ì„ í•˜ê³  ë°”ë¡œ í…Œì´ë¸”ì„ ë°©ë¬¸í•˜ì§€ ì•Šê³  ë¹„íŠ¸ë§µì˜ ë¹„íŠ¸ë¥¼ ì„¤ì •í•œë‹¤.
2. ë¹„íŠ¸ë§µ í™ ìŠ¤ìº”ìœ¼ë¡œ í•´ë‹¹ ë¹„íŠ¸ë§µì„ ì½ê³  ë©”ëª¨ë¦¬ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ë‹¤.
    - ë¹„íŠ¸ë§µìœ¼ë¡œ í˜ì´ì§€ ìˆ˜ë¥¼ ì•Œê³  ìˆì–´ì„œ í•œ ë²ˆì— í™ì—ì„œ ëª¨ë“  í˜ì´ì§€ë¥¼ ê°€ì ¸ì˜¨ë‹¤.
    - PostgresëŠ” ê°€ì ¸ì˜¨ í˜ì´ì§€ì˜ ë°ì´í„°ì—ì„œ ì¡°ê±´ì„ ë§Œì¡±í•˜ì§€ ì•ŠëŠ” ê²ƒì„ ì œê±°í•œë‹¤.
        - ì´ë¥¼ Recheck ê³¼ì •ì´ë¼ê³  í•œë‹¤.

ê°€ì • : IDì™€ Gì— ëª¨ë‘ ì¸ë±ìŠ¤ê°€ ìˆë‹¤.

```sql
explain select name from grades where g > 95 and id < 10000;
```

```sql
Bitmap Heap Scan using grades_pkey on grades (cost=3859.77..5479.62 rows=394 width=4)
	Recheck Cond: ((id < 10000) AND (g > 95))
	-> Bitmap Index Scan on grades_pkey (cost=0.00..180.21 rows=9570 width=0)
		Index Cond: (id < 10000)
	-> Bitmap Index Scan on g (cost=0.00..3808.31 rows=205850 width=0)
		Index Cond: (g > 95)
```

![image.png](%E1%84%8B%E1%85%B2%E1%84%83%E1%85%A6%E1%84%86%E1%85%B5%20%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%E1%84%87%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%80%E1%85%A8%2016564b4a4ab480ec8556dff4ee610feb/image%2022.png)

ì¸ë±ìŠ¤ Aì™€ Bì— ëª¨ë‘ ì¼ì¹˜í•˜ëŠ” ë¹„íŠ¸ë§Œì„ ê°€ì ¸ì˜¨ë‹¤.

<aside>
ğŸ“Œ

í˜ì´ì§€ë¥¼ ê°€ì ¸ì˜¤ë©´ ë°”ë¡œ ë°ì´í„° ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë‹¤. ê·¸ ì´ìœ ëŠ” ê³µìœ  ë©”ëª¨ë¦¬ì— ë°ì´í„°ê°€ ìˆê¸° ë•Œë¬¸

</aside>

## 25. ì‹ë³„ì, ë¹„ì‹ë³„ì ì—´ ë°ì´í„°ë² ì´ìŠ¤ ì¸ë±ì‹±

```sql

```
